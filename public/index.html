<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shopify App</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 16px;
    }
    button {
      padding: 8px 12px;
      cursor: pointer;
    }
    ul {
      margin-top: 16px;
    }
    li {
      margin-bottom: 6px;
    }
  </style>
</head>
<body>
  <h2>My Shopify App</h2>

  <button id="load">Load Products</button>

  <ul id="products"></ul>

  <script>
    const shop = new URLSearchParams(window.location.search).get("shop")
    const button = document.getElementById("load")
    const list = document.getElementById("products")

    if (!shop) {
      list.innerHTML = "<li>Open this app from the Shopify admin (missing <code>?shop=...</code>).</li>"
      button.disabled = true
    }

    button.addEventListener("click", async () => {
      if (!shop) return
      list.innerHTML = "<li>Loadingâ€¦</li>"

      try {
        const res = await fetch(`/products?shop=${encodeURIComponent(shop)}`)
        const data = await res.json().catch(() => ({}))
        const errMsg = data?.error || data?.message

        if (!res.ok) {
          list.innerHTML = `<li>${errMsg || "Error loading products"} (${res.status})</li>`
          return
        }

        const products = data?.data?.products?.edges || []

        list.innerHTML = ""
        if (!products.length) {
          list.innerHTML = "<li>No products found</li>"
          return
        }

        for (const { node } of products) {
          const li = document.createElement("li")
          li.textContent = node.title
          list.appendChild(li)
        }
      } catch (err) {
        list.innerHTML = "<li>Error loading products. Check the console.</li>"
      }
    })
  </script>
</body>
</html>
